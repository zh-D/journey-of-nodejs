### node 的诞生

Ryan Dahl 是一名资深的 c/c++ 程序员，在创造出 node 之后，他的主要工作都是围绕高性能 Web 服务器进行的。他找到了高性能 Web 服务器的几个要点：事件驱动、非阻塞 I/O。

Ryan Dahl 起初称它的项目为 Web.js ，就是一个 Web 服务器。选择 JavaScript 的原因是 JavaScript 比 C 的开发门槛要低，比 Lua 的历史包袱要少。**JavaScript 后端部分没有市场，可以说历史包袱几乎为 0，为其导入非阻塞 I/O 几乎没有阻力。JavaScript 在浏览器中有广泛的事件驱动方面的应用，暗合 Ryan Dahl 基于事件驱动的需求。**

但是项目的发展超过了他最初单纯开发一个 Web 服务器的想法，**变成了构建网络应用的基础框架，可以在它的基础上构建更多的东西，诸如服务器、客户端、命令行工具等。**

每一个Node进程都构成这个网络应用中的一个节点，这是它名字所含意义的真谛

### Node 与 Chrome 的对比

除了HTML、WebKit和显卡这些UI相关技术没有支持外，Node的结构与Chrome十分相似。 它们都是基于事件驱动的异步架构，浏览器通过事件驱动来服务界面上的交互，Node通过事件驱 动来服务I/O，这个细节将在第3章中详述。在Node中，JavaScript可以随心所欲地访问本地文件， 可以搭建WebSocket服务器端，可以连接数据库，可以如Web Workers一样玩转多进程。

Node打破了过去JavaScript只能在浏览器中运行的局面。前后端编程环境统一，可以大大降低前后端转换所需要的上下文交换代价。

(这里还提到 node-webkit 项目使得桌面应用程序的开发可以完全通过 HTML、CSS、JavaScript完成)

###  Node 的特点

#### 1、异步I/O

类似与浏览器的 Ajax，绝大多数的操作都以异步的方式进行调用，从文件读取到网络请求等，均是如此。这样可提高效率。

与其他的Web后端编程语言相比，Node除了异步和事件外，回调函数是一大特色。纵观下来， 回调函数也是最好的接受异步调用返回数据的方式。**但是这种编程方式对于很多习惯同步思路编程的人来说，也许是十分不习惯的。**代码的编写顺序与执行顺序并无关系，这对他们可能造成阅读上的障碍。在流程控制方面，因为穿插了异步方法和回调函数，与常规的同步方式相比，变得不那么一目了然。

**在转变为异步编程思维后，通过对业务的划分和对事件的提炼，在流程控制方面处理业务的 复杂度与同步方式实际上是一致的。** 关于流程控制和事件协作的方法和技巧我们将在第4章中进一步探讨。

#### 2、单线程

单线程的优点：

Node保持了JavaScript在浏览器中单线程的特点。而且在Node中，JavaScript与其余线程是无 法共享任何状态的。单线程的最大好处是不用像多线程编程那样处处在意状态的同步问题，这里 没有死锁的存在，也没有线程上下文交换所带来的性能上的开销。

单线程的缺点：

- 无法利用多核CPU
- 错误会引起整个应用退出，应用的健壮性值得考验
- 大量计算占用CPU导致无法继续调用异步I/O

就像浏览器里面执行JavaScript 会阻塞 UI 渲染一样，**Node 里面长时间的 CPU 计算会导致①后续的异步 I/O 发不出调用，②已完成的异步 I/O的回调函数得不到及时执行。**

**Node采用了与Web Workers相同的思路来解决单线程中大计算量的问题：child_process。这里请挪步到第9章。**

#### 3、跨平台

Node 基于 libuv 实现跨平台

###  Node 的应用场景

#### 1、IO 密集型

#### 2、是否不擅长CPU密集型业务

CPU密集型应用给Node 带来的挑战主要是：由于JavaScript单线程的原因，如果有长时间运行的计算（比如大循环），将 会导致CPU时间片不能释放，使得后续I/O无法发起。**但是适当调整和分解大型运算任务为多个小任务，使得运算能够适时释放，不阻塞I/O调用的发起，这样既可同时享受到并行异步I/O的好 处，又能充分利用CPU。**

就像浏览器一次执行 JavaScript 不能过久，就像浏览器垃圾回收算法也是分阶段，不能阻塞 UI 渲染一样。

有以下两个方式来充分 用CPU

- Node可以通过编写C/C++扩展的方式更高效地利用CPU
- 通过子进程的 方式，将一部分Node进程当做常驻服务进程用于计算，然后利用进程间的消息来传递结果，将计算与I/O分离，这样还能充分利用多CPU

#### 3、与遗留系统和平共处

- 在Web端，过去大多都是同步的方式编写的程序，这种串行调用下层应用数据的过程中充斥 着串行的等待时间，如果采用多线程来解决这种串行等待，又或多或少地显得小题大作。在Node 中，语言层面即可天然并行的特性在这种场景中显得十分有效。对于已有的稳定系统，并非意味着我们要抛弃掉。
- Node 可以将数据源当做数据接口， 发挥异步并行的优势，而不用关心它背后是用什么语言实现的。

#### 4、分布式应用

Node高效利用并行 I/O，在分布式应用中，在数据库集群中加快查询也有重要作用。

#### 5、应用实例

- 前后端编程语言环境统一
- Node带来的高性能I/O用于实时应用
- 并行I/O使得使用者可以更高效地利用分布式环境
- 并行I/O，有效利用稳定接口提升Web渲染能力
- 云计算平台提供Node支持
- 游戏开发领域
- 工具类应用