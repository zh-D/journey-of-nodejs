Node 相对于大多数 Web 技术还算是年轻的，这意味着没有现成和成熟的框架或应用系统可以直接上手使用，商业化还处于萌芽状态。反过来，这也能让开发者接触到较多的底层细节，如 HTTP 协议、进程模型、服务模型等，这些底层原理与其他现有技术并无实质性的差别。对于 Node 开发者而言，很多其他语言走过的路需要开发者带着 Node 特性重新去践行一遍。这并不是坏事， Node 更接近底层使得开发者对于具体细节的可控度非常高。

在实际的产品中，需要很多非编码相关的工作以保证项目的进展和产品的正常运行等，这些细节包括工程化、架构、容灾备份、部署和运维等。只有这些任务在持续性进行，才表明项目是活着的。

### 项目工程化

所谓的工程化，可以理解为项目的组织能力。体现在文件上，就是文件的组织能力。对于不同类型的项目，其组织方式也有所不同。除此之外，还应当有能够将整个项目串联起来的灵魂性文件。

项目的组织就犹如行军作战的阵法和章法，混乱而无目的的军队几乎不可能打胜仗，有其形、 有其魂的组织的生命周期才会更长，其形态才更稳固。

**在项目工程化过程中，最基本的几步是目录结构、构建工具、编码规范和代码审查**等，下面逐一讲解。

#### 目录结构

目前，主要的两类项目为Web应用和模块应用。普通的模块应用遵循 CommonJS 的模块和包规范即可，其细节可参见第2章。

对于 Web 应用，组织方式有各种各样，但是只要遵循单一原则即可。常见的 Web 应用都是以 MVC 为主要框架的，其余部分在这个基础上进行扩展。

某个Web应用项目：

```javascript
$ tree -L 2 
. 
├── History.md // 项目改动历史
├── INSTALL.md // 安装说明
├── Makefile // Makefile文件
├── benchmark // 基准测试
├── controllers // 控制器
├── lib // 没有模块化的文件目录
├── middlewares // 中间件
├── package.json // 包描述文件，项目依赖项配置等
├── proxy // 数据代理目录，类似MVC中的M
├── test // 测试目录
├── tools // 工具目录
├── views // 视图目录
├── routes.js // 路由注册表
├── dispatch.js // 多进程管理
├── README.md // 项目说明文件
├── assets // 静态文件目录
├── assets.json // 静态文件与CDN路径的映射文件
├── bin // 可执行脚本
├── config // 配置目录
├── logs // 日志目录
└── app.js // 工作进程
```

这个项目结构将各种功能的文件分门别类地归纳到目录中，其中包含普通的 MVC 约定 CommonJS 模块约定以及一些自有约定。成熟一点的 Web 应用框架（如Express）还提供了命令行工具来初始化 Web 应用，为开发者提供了一个较好的起点。

在实际的目录中，还存在 node_modules 这样一个目录，但这个目录通常不用加入到版本控制中。在部署项目时，我们通过 npm install 命令安装 package.json 中配置的依赖文件时，会自动生成这个目录。

### 构建工具

有了源代码项目，只是完成了第一步。**要想真正能用上源代码，还需要一定的操作，这些操作主要有合并静态文件、压缩文件大小、打包应用、编译模块等。**如果每次都手工完成这些操作， 效率会比较低下。为了节约资源，此类工作交给工具来完成比较合适，而构建工具就是完成此类需求的。将常用操作通过构建工具配置起来后，后续只要简单的命令就能完成大部分工作了。

在 Node 的应用中，主流的构建工具还是老牌的 make，但它的缺点是只在*nix操作系统下有效。为了实现跨平台，Grunt 应运而生。Grunt 通过 Node 写成，借助 Node 的跨平台能力，实现了很好的平台兼容性。下面简要介绍这两个工具。

#### Makefile

#### Grunt

### 编码规范

构建了良好的项目结构后，工程化算是有了一个不错的开头。也许很少有人遇见一个团队有很多人通过 JavaScript 开发应用的情景，但在 JavaScript 应用场景越来越多的情况下，整个团队一 起维护一份代码将会很常见。多人维护相同的代码，将会面临团队成员水平不一等问题。而代码是否具备良好的可维护性是最能体现团队素质的地方。为团队统一良好的编码风格，有助于帮助提升代码的可读性，进而提升可维护性。项目中代码的可维护性是影响项目后期成本的重要因素， 一旦早期不注重可维护性，后期项目的迭代和 bug 修复都会耗费巨大的成本。建议在项目一开始就制定基本的编码规范，让团队形成统一的风格。

编码规范的统一一般有几种实现方式，一种是文档式的约定，一种是代码提交时的强制检查。 前者靠自觉，后者靠工具。

在 JSLint 和 JSHint 工具的帮助下，现在已经能够很好地配置规则了。一旦团队约定了编码规范的详细规则，则可以生成一份规则文件。一些扫描工具或者编辑器能够通过该规则文件对源码进行扫描，直接提示开发者问题所在。

目前，我通过为项目创建 .jshintrc 文件，Sublime Text 2 编辑器在安装插件后可以实时自动扫描代码，并标注出编码中的问题所在。

关于编码规范，可以参见附录C，其中有详细的描述。

JavaScript 是一门太过于灵活的语言，每个团队应当有自己的约束规范，使得编码能够保持灵活又严谨，这对于工程化是一个很好的增进。

### 代码审查

代码审查需要耗费一定的精力，一些可以自动化完成的工作可以交由工具来自动完成，比如 编码规范的检查。但检查后的结果，还需要人工完成确认。尽管实行代码审查会花费一定的精力， 但是代码质量的稳固提升所带来的好处还是会逐渐回报给产品的。

在代码合并的过程中，一般还会集成单元测试的执行等环境，待一切都没有问题之后才会上线部署。

