Node 产品的性能与许多因素相关，这里我们将范畴缩减到 Web 应用中来，只评估一些常见的提升性能的方法。

对于 Web 应用而言，最直接有效的莫过于动静分离、多进程架构、分布式，其中涉及的几个拆分原则如下所示。

- 做专一的事。 
- 让擅长的工具做擅长的事情。 
- 将模型简化。 
- 将风险分离。

除此之外，缓存也能带来很大的性能提升。

### 动静分离

在普通的 Web 应用中，Node 尽管也能通过中间件实现静态文件服务，但是 Node 处理静态文件的能力并不算突出。

将图片、脚本、样式表和多媒体等静态文件都引导到专业的静态文件服务器 上，让 Node 只处理动态请求即可。这个过程可以用 Nginx 或者专业的 CDN 来处理。

将动态请求和静态请求分离后，服务器可以专注在动态服务方面，专业的 CDN 会将静态文件与用户尽可能靠近，同时能够有更精确和高效的缓存机制。静态文件请求分离后，对静态请求使用不同的域名或多个域名还能消除掉不必要的 Cookie 传输和浏览器对下载线程数的限制。

静态文件和动态请求分离只是最简单的分离，也较容易实现。**事实上还有更复杂的情况，比如一个网页中同时存在动态数据和静态内容，在 Node 中将内容发送至客户端时需要进行字符串到 Buffer 的转换，但是对于静态内容而言无须进行字符串层级的替换，只要保留成 Buffer 即可。**直接进行 Buffer 传输可以很大程度上提升性能，这在第 6 章中已演示过。**是故能够在动态内容中再将动态内容和静态内容分离，还能进一步提升性能，但这种程度上的控制也许没有普适性，需要较多细节处理。**

### 启用缓存

提升性能其实差不多只有两个途经，一是提升服务的速度，二是避免不必要的计算。前者提升的性能在海量流量面前终有瓶颈，但后者却能够在访问量越大时收益越多。避免不必要的计算， 应用场景最多的就是缓存。

尽管同步 I/O 在 CPU 等待时浪费的时间较为严重，但是在缓存的帮助下，却能够消减同步 I/O 带来的时间浪费。但不管是同步 I/O 还是异步 I/O，避免不必要的计算这条原则如果遵循得较好， 性能提升是显著的。

如今，Redis 或 Memcached 几乎是 Web 应用的标准配置。如果你的产品需要应对巨大的流量， 启用缓存并应用好它，是系统性能瓶颈的关键。

### 多进程架构

由于 Node 是通过自有模块构建 HTTP 服务器的，不像大多数服务器端技术那样有专有的 Web 容器，所以需要开发者自己处理多进程的管理。不过好在官方已经有 cluster 模块，在社区也有 pm、forever、pm2 这样的模块用于 进程管理，这里不再展开具体细节。

### 读写分离

除了动静分离外，另一个较为重要的分离是读写分离，这主要针对数据库而言。**就任意数据库而言，读取的速度远远高于写入的速度。而某些数据库在写入时为了保证数据一致性，会进行锁表操作，这同时会影响到读取的速度。某些系统为了提升性能，通常会进行数据库的读写分离， 将数据库进行主从设计，这样读数据操作不再受到写入的影响，降低了性能的影响。**

此外，还有其他许多方案用以提升系统性能，以应对海量的请求，这里不再一一展开。